<div class="panel-group" id="accordion">
  
  <% @tables.each do |table| %>
  <% free = table.free %>
  
  <div class="panel panel-default">
    
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#accordion" href="#collapse<%= table.id %>">
        <%= "Table #{table.id}: #{free == 8 ? "Empty" : free == 0 ? "Full" : "#{free} openning#{ free != 1 ? 's' : ''}"}" %></a>
      </h4>
      <div class="progress">
        <% percent = number_to_percentage((8 - free) / 8.0 * 100) %>
        <div class="progress-bar <%= free > 2 ? "progress-bar-success" : free == 0 ? "progress-bar-danger" : "progress-bar-warning" %>" role="progressbar" aria-valuenow="<%= 8 - free %>"
        aria-valuemin="0" aria-valuemax="8" style="width:<%= percent %>">
          <span class="sr-only"><%= percent %> Complete</span>
        </div>
      </div>
    </div>
    
    <div id="collapse<%= table.id %>" class="panel-collapse collapse">
      <div class="panel-body">
         <div class="container">
          <div class="row">
            <form action="table/<%= table.id %>" method="post" >
              <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
              <div class="form-group">
                <label>Pick your guest: 
                  <select class="form-control" name="guest">
                     <% @my_guests.each do |g| %>
                     <% if !g.table_id %>
                     <option value ="<%= g.id %>"><%= "#{g.first_name} #{g.last_name}" %></option>
                     <% end %>
                     <% end %>
                  </select>
                </label>
              </div>
              <% 8.times do |i| %>
              <div class="col-xs-2 col-md-1 panel panel-default">
                <div class="panel-body">
                <%= image_tag("chair.png", :alt => "chair") %>
                <%= table.send("guest#{i + 1}_id") == 0 ? "Empty" : "#{@guests.find(table.send("guest#{i + 1}_id")).first_name} #{@guests.find(table.send("guest#{i + 1}_id")).last_name}" %>
                <% if table.send("guest#{i + 1}_id") == 0 and @my_guests.find_by table_id: NIL %>
                <input type="submit" class="btn btn-success btn-xs" value="Select <%= i+1 %>" name="seat_id">
                <% elsif @my_guests.find_by id: table.send("guest#{i + 1}_id") %>
                <a href="#" class="btn btn-danger btn-xs" role="button">Cancel</a>
                <% end %>
                </div>
              </div>
              <% end %>
            </form>
          </div>
        </div>
      </div>
    </div>
    
  </div>
  
  <% end %>
  
</div>