<div class="panel-group" id="accordion">
  
  <% @tables.each do |table| %>
  <% free = table.free %>
  
  <div class="panel panel-default">
    
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#accordion" href="#collapse<%= table.id %>">
        <%= "Table #{table.id}: #{free == 8 ? "Empty" : free == 0 ? "Full" : "#{free} openning#{ free != 1 ? 's' : ''}"}" %></a>
      </h4>
      <div class="progress">
        <% percent = number_to_percentage((8 - free) / 8.0 * 100) %>
        <div class="progress-bar <%= free > 2 ? "progress-bar-success" : free == 0 ? "progress-bar-danger" : "progress-bar-warning" %>" role="progressbar" aria-valuenow="<%= 8 - free %>"
        aria-valuemin="0" aria-valuemax="8" style="width:<%= percent %>">
          <span class="sr-only"><%= percent %> Complete</span>
        </div>
      </div>
    </div>
    
    <div id="collapse<%= table.id %>" class="panel-collapse collapse">
      <div class="panel-body">
         <div class="container">
          <div class="row">
            <form action="table/<%= table.id %>" method="post" >
              <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
              <div class="form-group">
                <label>Pick your guest: 
                  <select class="form-control" name="guest">
                    <% valid_guests = 0 %>
                    <% @my_people.each do |g| %>
                    <% if !g.table_id %>
                    <% valid_guests += 1%>
                    <option value ="<%= g.id %>"><%= "#{g.first_name} #{g.last_name}" %></option>
                    <% end %>
                    <% end %>
                    <% if valid_guests == 0 %>
                    <option>All your guests are assigned</option>
                    <% end %>
                  </select>
                </label>
              </div>
              <% 8.times do |i| %>
              <div class="col-xs-2 col-md-1 panel panel-default">
                <div class="panel-body">
                <%= image_tag("chair.svg", :alt => "chair", size: "64") %>
                <% occupied_by = table.send("guest#{i + 1}_id") %>
                <%= !occupied_by ? "Empty" : get_name_given_person_id(table.send("guest#{i + 1}_id")) %>
                <% if !occupied_by and valid_guests > 0 %>
                <input type="submit" class="btn btn-success btn-xs" value="Select <%= i+1 %>" name="seat_id">
                <% elsif person_current_user? table.send("guest#{i + 1}_id") %>
                <a href="<%= "table/#{table.id}/remove/#{i + 1}" %>" class="btn btn-danger btn-xs" role="button">Cancel</a>
                <% end %>
                </div>
              </div>
              <% end %>
            </form>
          </div>
        </div>
      </div>
    </div>
    
  </div>
  
  <% end %>
  
</div>